(function (dayjs) {
    'use strict';

    async function getXKCD() {
        const url = `https://fwd.innopolis.app/api/hw2/?${new URLSearchParams({ email: 'd.vasilev@innopolis.university' })}`;
        const response = await fetch(url);
        const id = await response.text();
        const request = `https://fwd.innopolis.university/api/comic?${new URLSearchParams({ id })}`;
        const response2 = await fetch(request);
        return await response2.json();
    }
    async function setXKCDData() {
        const jsonData = await getXKCD();
        const photoElement = document.getElementById('photo');
        const dateElement = document.getElementById('date');
        photoElement.src = jsonData.img;
        photoElement.alt = jsonData.alt;
        photoElement.title = jsonData.safe_title;
        dateElement.textContent = 'Date of publishing: ' + dayjs(jsonData.year.toString() + '-' + jsonData.month.toString() + '-' + jsonData.day.toString()).format('DD/MM/YYYY');
    }
    window.onload = () => {
        setXKCDData();
        const btn = document.getElementById("newcomicbtn");
        btn.addEventListener("click", (e) => setXKCDData());
    };

})(dayjs);
